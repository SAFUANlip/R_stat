library(MASS)
library(car)
library(rgl)
library(glmnet) # to use LASSO
data <- read.table("asthma.txt")
View(data)
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
summary(lm)
lm <- lm(asthma ~ -1 + urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
shapiro.test(lm$residuals)
View(data)
par(mfrow=c(2,2)); plot(fm)
par(mfrow=c(2,2)); plot(lm)
rep(c(0,1),c(55,55))
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ rep(c(0,1),c(55,55)) + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
View(data)
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
factor(rep(c(0,1),c(55,55)))
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ factor(rep(c(0,1),c(55,55))) + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ factor(rep(c(0,1),c(55,55))) + age:rep(c(0,1),c(55,55)) + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
data <- read.table("asthma.txt")
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
par(mfrow=c(2,2)); plot(lm)
shapiro.test(lm$residuals)
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ -1 + urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
par(mfrow=c(2,2)); plot(lm)
shapiro.test(lm$residuals)
data[92, ]
data_new  <- data[-92, ]
summary(lm)
confint(lm, parm="asthma", level = 0.95)
confint(lm, parm="age", level = 0.95)
confint(lm, parm="urbanYes", level = 0.95)
confint(lm, parm="urbanNo", level = 0.95)
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
summary(lm)
confint(lm, parm="urbanNo", level = 0.95)
confint(lm, parm="urbanYes", level = 0.95)
summary(lm)
lm2 <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income, data = data)
summary(lm2)
lm3 <- lm(asthma ~ urban + pollution + sunny + tobacco + income, data = data)
summary(lm3) # removed age
library(nlme)
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitz <- gls(asthmay ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm, form = ~1| region_id), data = data)
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitz <- gls(asthmay ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm, form = ~1| region_id) data = data)
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitz <- gls(asthmay ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm(form = ~1| region_id), data = data))
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitz <- gls(asthmay ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm(form = ~1| region_id), data = data)
summary(fit2)
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitz <- gls(asthma ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm(form = ~1| region_id), data = data)
summary(fit2)
# Update it by introducing a compound-Symmetry Correlation Structure using
# the region as a grouping factor (model M1).
fitS <- gls(asthma ~ urban + pollution + sunny + income + tobacco,
correlation = corCompSymm(form = ~1| region_id), data = data)
summary(fitS)
plot(fitS)
intervals(fitS, which = "var-cov", level = 0.99)
intervals(fitS, which = "var", level = 0.99)
intervals(fitS, which = "var", level = 0.99)
intervals(fitS, which = "var-сov", level = 0.99)
intervals(fitS, which = "var-cov", level = 0.99)
library(lme4)
fitM2 <- lme(asthma ~ urban + pollution + sunny + income + tobacco,
random = ~1|region_id,
data = data)
summary(fitM2)
summary(fitS)
summary(lm3) # removed age
summary(fitS)
summary(fitM2) # we don't see any signifficant difference between lsat two models
confint(lm, level = 0.95)
summary(lm)
data <- read.table("asthma.txt")
# if our urban been numerical variabel, 0/1, then R will use it as numeric, not factor
# but we expected to use factor
lm <- lm(asthma ~ urban + age + pollution + sunny + tobacco + income + education, data = data)
data <- read.table("asthma.txt", h=TRUE)
data <- read.table("asthma.txt", h=TRUE)
View(data)
str(data)
data <- read.table("asthma.txt", h=TRUE)
data$province_id.f <- as.factor(data$province_id)
data$region_id.f <- as.factor(data$region_id)
data$urban <- as.factor(data$urban)
str(data)
lm <- lm(asthma~1+age, data=data)
summary(lm)
lm <- lm(asthma~1 + age + pollution + sunny + tobacco + income + education, data=data)
summary(lm)
lm <- lm(asthma~ -1 + urban + age + pollution + sunny + tobacco + income + education, data=data)
summary(lm)
#
qqnorm(lm)
#
qqnorm(resid(lm))
qqline(resid(lm), col='red', lwd=2)
shapiro.test(lm$residuals)
plot(lm)
par(mfrow=c(2,2))
plot(lm)
summary(lm)
# Can we affirm at 90% confidence level that the age has a positive effect on asthma prevalence?
confint(lm)
# Can we affirm at 90% confidence level that the age has a positive effect on asthma prevalence?
confint(lm, level=0.90)
# Can we affirm at 90% confidence level that the age has a positive effect on asthma prevalence?
confint(lm, level=1-0.1/8) # CI for Age doesn not contain 0, and
# reduce model
lm2 <- lm(asthma~ -1 + urban + age + pollution + sunny + tobacco + income, data=data)
summary(lm2)
lm3 <- lm(asthma~ -1 + urban + pollution + sunny + tobacco + income, data=data)
summary(lm3)
View(data)
# compound-Symmetry Correlation
glm3 <- gls(asthma~ -1 + urban + pollution + sunny + tobacco + income,
correlation = corCompSymm(form = ~1|region_id.f),
data=data)
summary(glm3)
confint(glm3)
confint(glm3, "var-cov")
intervals(glm3, which = "var-cov")
intervals(glm3, which = "var-cov", level = 0.99)
anova(lm3, glm3)
anova(glm3, glm3)
# compound-Symmetry Correlation
lm3_anova <- gls(asthma~ -1 + urban + pollution + sunny + tobacco + income,
data=data)
anova(lm3_anova, glm3)
lm3_anova
lm3
llm3 <- lme(asthma~ -1 + urban + pollution + sunny + tobacco + income,
random= ~1|region_id.f
data=data)
llm3 <- lme(asthma~ -1 + urban + pollution + sunny + tobacco + income,
random= ~1|region_id.f,
data=data)
summary(llm3)
llm3 <- lme(asthma~ -1 + urban + pollution + sunny + tobacco + income,
random= ~1|region_id.f,
data=data)
summary(llm3)
anova(glm3, llm3)
anova(lm3, llm3)
anova(lm3_anova, llm3)
View(data)
View(data)
data[data$urban == "YES"]
data[data$urban == "YES"]
delta_mean <- data[data$urban == "YES"] - data[data$urban == "NO"]
delta_mean <- mean(data[data$urban == "YES"] - data[data$urban == "NO"])
delta_mean <- sapply(data[data$urban == "YES"] - data[data$urban == "NO"], mean)
delta_mean
delta_mean <- sapply(data[data$urban == "YES"]$asthma - data[data$urban == "NO"]$asthma, mean)
delta_mean
data[data$urban == "YES"]$asthma
data$urban == "YES"
delta_mean <- sapply(data[data$urban == "YES",]$asthma - data[data$urban == "NO",]$asthma, mean)
data[data$urban == "NO",]
data[data$urban == "YES",]
data[data$urban == "YES"]
mean(data[data$urban == "YES"])
data[data$urban == "YES"]$asthma
data$urban == "YES"
View(data)
delta_mean <- sapply(data[data$urban == "Yes"]$asthma - data[data$urban == "No"]$asthma, mean)
View(data)
data[data$urban == "No"]
data$urban == "Yes"
delta_mean <- sapply(data[data$urban == "Yes",]$asthma - data[data$urban == "No",]$asthma, mean)
delta_mean
delta_mean <- data[data$urban == "Yes",]$asthma - data[data$urban == "No",]$asthma
delta_mean <- mean(data[data$urban == "Yes",]$asthma - data[data$urban == "No",]$asthma)
D.cov <- cov(data[data$urban == "Yes",]$asthma - data[data$urban == "No",]$asthma)
D.cov <- cov(as.matrix(data[data$urban == "Yes",]$asthma - data[data$urban == "No",]$asthma))
D.inv <- solve(D.cov)
c(delta_mean - cfr.t*sqrt(D.cov[1,1]/110),
delta_mean,
delta_mean + cfr.t*sqrt(D.cov[1,1]/110))
cfr.t <- qt(1-0.05/(2), 110-1)
c(delta_mean - cfr.t*sqrt(D.cov[1,1]/110),
delta_mean,
delta_mean + cfr.t*sqrt(D.cov[1,1]/110))
lm <- lm(asthma~ -1 + urban + age + pollution + sunny + tobacco + income + education, data=data)
summary(lm)
confint(lm, parm="urbanYes", level = 0.95)
confint(lm, level = 0.95)
confint(lm, parm="urbanYes"-'urbanNo', level = 0.95)
confint(lm, parm="urbanYes", level = 0.95)
confint(lm, parm="urbanYes", level = 0.95) - confint(lm, parm="urbanNo", level = 0.95)
coef_diff <- coef(lm)["urbanYes"] - coef(lm)["urbanNo"]
# Получаем ковариационную матрицу коэффициентов
vcov_mat <- vcov(lm)
# Стандартная ошибка разности
se_diff <- sqrt(vcov_mat["urbanYes", "urbanYes"] +
vcov_mat["urbanNo", "urbanNo"] -
2 * vcov_mat["urbanYes", "urbanNo"])
# 95% доверительный интервал (двусторонний)
t_crit <- qt(0.975, df = df.residual(lm))
ci_low <- coef_diff - t_crit * se_diff
ci_high <- coef_diff + t_crit * se_diff
c("diff" = coef_diff, "lower" = ci_low, "upper" = ci_high)
